# Category 0: The Android Framework

## Q) 30. What is R8 optimization?

`R8`은 APK/AAB의 크기를 줄이고 런타임 성능을 개선하기 위해 안드로이드 빌드 과정에서 사용되는 코드 축소, 최적화 도구이다.
이전의 `ProGuard`를 대체하며, 안드로이드 빌드 시스템과 매끄럽게 통합되어 **코드 축소**, **최적화**, **난독화**, **리소스 관리** 등 고급 기능을 제공한다.

### R8 동작 방식
`R8`은 빌드 단계에서 앱 코드를 처리해 다음을 수행한다:

- **코드 축소:** 사용되지 않는 클래스, 메서드, 필드, 어트리뷰트를 제거해 최종 APK/AAB 크기를 줄인다.

- **최적화:** 런타임 성능 향상을 위해 코드를 단순화, 재구성한다. 메서드 인라인, 중복 코드 제거, 중복 블록 병합 등이 여기에 포함된다.

- **난독화:** 클래스, 메서드, 필드 이름을 바꿔 원래 의미를 숨김으로써 리버스 엔지니어링을 어렵게 한다.

- **리소스 최적화:** 사용되지 않는 리소스(레이아웃, 드로어블, 문자열 등)를 제거해 앱 크기를 추가로 줄인다.

### R8 최적화의 핵심 기능

- **Dead Code 제거:** 앱에서 도달하지 못하거나 사용되지 않는 코드를 분석해 제거한다.

- **Inlining:** 짧은 메서드/함수를 호출 지점에 직접 삽입해 메서드 호출 오버헤드를 줄이고 성능을 높인다.

- **클래스 병합:** 유사한 클래스나 인터페이스를 하나로 합쳐 메모리 사용량을 줄이고 효율을 높인다.

- **도달 불가 코드 제거:** 절대 실행되지 않는 코드 경로를 완전히 삭제한다.

- **상수 폴딩 및 전파:** 식을 단순화하고 가능한 곳에 변수 대신 상수 값을 대입한다.

- **난독화:** 의미 있는 식별자 이름을 더 짧고 추상적인 이름으로 바꿔 앱 크기를 줄이고 리버스 엔지니어링을 어렵게 한다.

### R8 설정
  
`R8`는 설정에 **ProGuard rules**을 사용한다. 어떤 코드를 축소, 난독화 및 최적화 대상에서 제외할지 규칙으로 지정할 수 있다.

- **리플렉션으로 접근하는 코드 보존:** 리플렉션으로 접근하는 클래스/메서드는 ProGuard rules에서 명시적으로 -keep 해야 한다.

- **서드파티 라이브러리 제외/예외 규칙:** 일부 라이브러리는 기능이 깨지지 않도록 특정 규칙이 필요하다.

### R8의 장점

**밀접한 통합:** `R8`은 안드로이드 빌드 시스템에 내장되어 있어 기존 ProGuard rules 외 **추가 설정**이 거의 필요 없다.

**향상된 효율성:** 축소, 최적화, 난독화를 한 번에 처리하여 ProGuard보다 빠르고 효율적이다.

**앱 크기 감소:** 사용되지 않는 코드와 리소스를 제거해 최종 APK/AAB 크기를 크게 줄인다.

**보안 강화:** 난독화로 리버스 엔지니어링을 어렵게 만들어 지식재산을 보호한다.

### R8의 한계

- **과도한 축소 위험:** 설정이 부정확하면 간접 참조되는 코드/리소스가 제거되어 런타임 오류가 발생할 수 있다.

- **복잡한 설정:** 리플렉션이나 동적 클래스 로딩을 쓰는 복잡한 프로젝트는 ProGuard 규칙 작성이 까다롭다.

- **디버깅 어려움:** 난독화로 스택 트레이스에 난독화된 이름이 포함되어 디버깅이 어려워질 수 있다.

### 실전 질문
**Q)** `R8` 최적화가 성능과 APK/AAB 크기를 어떻게 줄이나요?

**Q)** `R8`은 ProGuard와 무엇이 다르고, 이에 따른 장점은 무엇인가요?

**A)** `R8`은 DEX 레벨에서 축소, 최적화, 난독화를 한 번에 수행하는 반면, Proguard는 Java 바이트코드를 대상으로 수행 후 DEX로 변환합니다.